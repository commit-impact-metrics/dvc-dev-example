# Оценка технологического риска внедрения релизов ПО для ETL и DWH

## Оглавление

1. [Исходный проект](#Исходный-проект-Commit-impact-metrics)
2. [Начало работы](#Начало-работы)
3. [TODO](#TODO)
4. [Запуск тестов](#Запуск-тестов)
5. [Состав команды и роли](#Состав-команды-и-роли)
6. [Состояние проекта](#Состояние-проекта)
7. [Вехи работы над проектом](#Вехи-работы-над-проектом)
8. [Используемые технологии](#Используемые-технологии)
9. [Архитектура](#Архитектура)
10. [Контакты](#Контакты)

## Задача

Разработать алгоритм (модель, методику) и программу для оценки технологического риска внедрений релизов программного обеспечения, предназначенного для выполнения процедур трансформации данных (ETL) и расчетов на витринах хранилища данных (DWH).

## Исходный проект Commit-impact-metrics

Источник: https://github.com/iterative/example-get-started.git

## Начало работы

```
python -m venv .venv
source .venv/bin/activate
pip install -r src/requirements.txt
```

пример использования
```
python -m cim 2-track-data
```
проведет сравнение текущей ветки с веткой 2-track-data. Результат запишет в output.

## TODO
1. Переопределить функции из cim/state, чтобы добавить более актуальные метрики сравнения;
2. Добавить конфиги;
3. Определить список поддерживаемых файлов. Неподдерживаемые игнорить при сравнении (.pkl сравнивать или нет? По какой метрике?)

## Запуск тестов

Для запуска тестов выполните следующие шаги:

1. Убедитесь, что у вас установлен `pytest`. Если нет, установите его с помощью команды:
   ```sh
   pip install pytest
   ```

2. Перейдите в корневую директорию вашего проекта.

3. Запустите `pytest` с помощью следующей команды:
   ```sh
   pytest
   ```
## Запуск демонстрации

python comb <teamMetrics> <businessMetrics> <pathToDataMetrics>


## Состав команды и роли

**Команда**: 37 МФТИ Сбер  
**Состав**:
- **Никита Ломов** — Team Lead  
- **Андрей Гриценко** — Разработчик  
  *Реализация обработки dvc.*
- **Анастасия Токарева** — Аналитик  
  *Подготовка алгоритма оценки риска изменения качества данных на базе изменений в dvc.*
- **Владимир Ульзутуев** — Аналитик  
  *Подготовка алгоритма оценки рисков нарушения бизнес-процессов, их простоя и срочности задач в релизе.*

## Состояние проекта

- **Готова программа** для сравнения веток в DVC (cim).
- **Готова программа** для оценки комбинированного риска (comb).   
- **Готов анализ** и метрики для оценки качества данных (analysis/metrics).
- **Готов анализ** и метрики для оценки бизнес-рисков (analysis/risk).

## Вехи работы над проектом

- **Открытие хакатона** 02.12.2024 - Пройдена
- **Сбор команды** 03.12.2024 - Пройдена
- **Синк с командой и начало поиска решения** 04.12.2024 - Пройдена
- **Первая встреча с ментором** 09.12.2024 - Пройдена
- **Завершение поиска и распределение по ролям** 09.12.2024 - Пройдена
- **Первая версия программы и завершение анализа** 12.12.2024 - Пройдена
- **Оформление и промежуточная сдача работы** 13.12.2024 - Пройдена
- **Вторая встреча с ментором** 17.12.2024 - Пройдена
- **Доработки и формление** 18.12.2024 - Пройдена
- **Сдача работы** 19.12.2024 - Пройдена
- **Защита** 20.12.2024

## Используемые технологии

- **DVC** — ключевая технология для управления данными и их версионирования.
- **Python** — для разработки программного обеспечения.
- **Git** — для работы с репозиториями и ветками.

## Архитектура

Проект состоит из пяти основных компонентов:

### 1. **Основной модуль (`cim/__main__.py`)**
   - Принимает аргументы командной строки для сравнения веток (compare_branches) или коммитов (analyze_two_commits_with_cache).
   - Если аргумент --commits указан, сравниваются два коммита. Если нет, сравниваются ветки, начиная с их последних коммитов (HEAD).

### 2. **Сравнение веток (`cim/branches.py`)**
   - Использует временный клон репозитория.
   - Получает последние коммиты веток с помощью git rev-parse HEAD.
   - Передаёт эти коммиты в модуль анализа (analyze_two_commits_with_cache).

### 3. **Анализ коммитов (`cim/commits.py`)**
   - Создаёт временные папки для файлов из обоих коммитов.
   - Выгружает файлы, указанные в dvc.yaml (DVC используется для управления данными).
   - Сравнивает содержимое файлов с использованием функций из analysis.py (calculate_risk).
   - Сохраняет результаты в JSON-файлы.

### 4. **Работа с состоянием файлов (`cim/state.py`)**
   - Собирает информацию о файлах и подсчитывает строки в каждом файле.
   - Сравнивает два состояния файлов, генерируя метрики изменений (добавленные, удаленные строки).

### 5. **Вспомогательные утилиты (`cim/utils.py`)**
   - Клонирует репозиторий, сохраняет метрики в файлы, получает последние коммиты и подсчитывает строки в файлах.

### 6. **Ключевой алгоритм (`cim/analysis.py`)**
   - calculate_risk оценивает изменения в данных между двумя состояниями
   - Каждое изменение нормализуется относительно исходных данных и взвешивается с использованием коэффициентов.

## Контакты

Для вопросов и предложений можно обращаться в TG @Loprima.